{"version":3,"sources":["all.js"],"names":["$","document","ready","console","log","sidebarSwitch","querySelector","sidebar","mapElement","getElementById","list","city","area","dayElement","dateElement","todayLimitLastIdNumber","date","Date","day","getDay","year","getFullYear","month","getMonth","todayDate","getDate","lat","lng","addEventListener","e","classList","toggle","map","L","center","zoom","tileLayer","attribution","addTo","markers","MarkerClusterGroup","greenIcon","Icon","iconUrl","shadowUrl","iconSize","iconAnchor","popupAnchor","shadowSize","redIcon","getUrl","url","Promise","resolve","reject","req","XMLHttpRequest","open","onload","status","JSON","parse","responseText","Error","send","renderList","listDatas","listStr","btnColor","i","length","total","storeNm","longitude","latitude","zipCd","addr","tel","busiTime","innerHTML","setViewTargetMarker","showTargetMarker","querySelectorAll","forEach","element","preventDefault","parseFloat","target","dataset","latLng","mediaQueryList","window","matchMedia","setView","eachLayer","layer","_latlng","openPopup","matches","getGeolocation","navigator","geolocation","getCurrentPosition","position","coords","get3000Datas","getCityDatas","all","then","res","ticketDatas","cityDatas","selectedCity","cityStr","defaultAreaStr","markerIcon","ticketCountColor","parseInt","addLayer","marker","icon","bindPopup","updateTime","busiMemo","filter","item","hsnNm","defaultCity","CityName","AreaList","AreaName","index","areaStr","value","includes","cityList","selectedArea","err"],"mappings":"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","file":"all.js","sourcesContent":["$(document).ready(() => {\n  console.log('Hello Bootstrap4');\n});\n\n// 選取 DOM\nconst sidebarSwitch = document.querySelector('.sidebarSwitch');\nconst sidebar = document.querySelector('.sidebar');\nconst mapElement = document.getElementById('map');\nconst list = document.querySelector('.list');\nconst city = document.querySelector('.city');\nconst area = document.querySelector('.area');\nconst dayElement = document.querySelector('.day');\nconst dateElement = document.querySelector('.date');\nconst todayLimitLastIdNumber = document.querySelector('.todayLimitLastIdNumber');\n\n// 建立 Date 物件與將日期相關的資訊存放到常數中方便與日期相關操作\nconst date = new Date();\nconst day = date.getDay();\nconst year = date.getFullYear();\nconst month = date.getMonth();\nconst todayDate = date.getDate();\n\n// 宣告經緯度的變數以便將使用者的地理位置存放到常數中來使用\nlet lat;\nlet lng;\n\n// 伸縮 sidebar\nsidebarSwitch.addEventListener('click', function (e) {\n  sidebar.classList.toggle('active');\n  this.classList.toggle('active');\n  mapElement.classList.toggle('active');\n});\n\n// 初始化地圖\nconst map = L.map('map', {\n  center: [23.9134578,120.6903032],\n  zoom: 15\n});\n\n// 指定要讓 leftlet 使用的第三方圖資\nL.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n  attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n}).addTo(map);\n\n// 將群集化 marker 圖層加到地圖上\nconst markers = new L.MarkerClusterGroup().addTo(map);\n\n// 新增有三倍券時 marker 的圖標\nconst greenIcon = new L.Icon({\n  iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',\n  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',\n  iconSize: [25, 41],\n  iconAnchor: [12, 41],\n  popupAnchor: [1, -34],\n  shadowSize: [41, 41]\n});\n\n// 新增沒有三倍券時 marker 的圖標\nconst redIcon = new L.Icon({\n  iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',\n  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',\n  iconSize: [25, 41],\n  iconAnchor: [12, 41],\n  popupAnchor: [1, -34],\n  shadowSize: [41, 41]\n});\n\n// 將撈取遠端資料的操作進行封裝以便重複使用\nfunction getUrl(url) {\n  return new Promise((resolve, reject) => {\n    const req = new XMLHttpRequest();\n    req.open('GET', url);\n    req.onload = function () {\n      if (req.status === 200) {\n        resolve(JSON.parse(req.responseText));\n      } else {\n        reject(new Error(req));\n      }\n    };\n    req.send(null);\n  });\n}\n\n// 渲染出側邊欄列表資訊\nfunction renderList(listDatas){\n  let listStr = '';\n  let btnColor = '';\n\n  for(let i = 0; i < listDatas.length; i++){\n    if(listDatas[i].total > 0) {\n      btnColor = 'btn-primary';\n    }else{\n      btnColor = 'btn-gray';\n    }\n\n    listStr += `\n      <li class=\"py-3 mx-3 border-bottom\">\n        <h5 class=\"h5 d-flex justify-content-between font-weight-bold text-dark my-2\">${listDatas[i].storeNm}<div><a href=\"#\" class=\"d-inline-block align-middle showTargetMarker material-icons h2 mb-0\" data-lng=\"${listDatas[i].longitude}\" data-lat=\"${listDatas[i].latitude}\">visibility</a></div></h5>\n        <p class=\"text-grayer mb-1\">地址：${listDatas[i].zipCd} ${listDatas[i].addr}</p>\n        <p class=\"text-grayer mb-1\">電話：${listDatas[i].tel}</p>\n        <p class=\"text-grayer mb-2\">營業時間：${listDatas[i].busiTime}</p>\n        <button class=\"btn ${btnColor} rounded-pill text-white\">三倍券庫存量：<strong>${listDatas[i].total}</strong></button>\n      </li>\n    `;\n  }\n  list.innerHTML = listStr;\n\n  setViewTargetMarker();\n}\n\n// 在側邊欄列表中點選其中一間郵局的 icon(眼睛) 時，會將地圖移動到對應的 marker 並顯示 popup 視窗\nfunction setViewTargetMarker() {\n  const showTargetMarker = document.querySelectorAll('.showTargetMarker');\n  showTargetMarker.forEach(function(element){\n    element.addEventListener('click', function(e){\n      e.preventDefault();\n      const lat = parseFloat(e.target.dataset.lat);\n      const lng = parseFloat(e.target.dataset.lng);\n      const latLng = L.latLng(lat, lng);\n      const mediaQueryList = window.matchMedia(\"(max-width: 414px)\"); // 將要匹配的螢幕解析度儲存到常數中\n      \n      map.setView(latLng, 16);\n      markers.eachLayer(function(layer) {\n        if(layer._latlng.lat === lat && layer._latlng.lng === lng){\n          layer.openPopup();\n        }\n      });\n\n      if (mediaQueryList.matches) { // 判斷螢幕解析度是否符合 414px\n        sidebar.classList.toggle('active');\n        sidebarSwitch.classList.toggle('active');\n        mapElement.classList.toggle('active');\n      }\n    });\n  });\n}\n\n\n\n// 首次載入網頁時取得使用者的經緯度座標並設置為地圖中心\nfunction getGeolocation(){\n  if(navigator.geolocation){\n    navigator.geolocation.getCurrentPosition(function(position) {\n      let latLng;\n\n      lat = position.coords.latitude;\n      lng = position.coords.longitude;\n      latLng = L.latLng(lat, lng);\n\n      map.setView(latLng);\n    });\n  }\n}\ngetGeolocation();\n\n// 顯示今天星期幾到畫面上\nswitch (day){\n  case 1:\n    dayElement.innerHTML = '星期一';\n    break;\n  case 2:\n    dayElement.innerHTML = '星期二';\n    break;\n  case 3:\n    dayElement.innerHTML = '星期三';\n    break;\n  case 4:\n    dayElement.innerHTML = '星期四';\n    break;\n  case 5:\n    dayElement.innerHTML = '星期五';\n    break;\n  case 6:\n    dayElement.innerHTML = '星期六';\n    break;\n  case 7:\n    dayElement.innerHTML = '星期日';\n    break;\n}\n\n// 將取得的日期(YYYY-mm-dd)顯示到畫面上\ndateElement.innerHTML = `${year}-${month+1}-${todayDate}`;\n\n// 顯示今日可領取(兌換)三倍券的身分證尾碼\nif(day === 1 || day === 3 || day === 5){\n  todayLimitLastIdNumber.innerHTML = `身分證末碼為<span class=\"h4 text-warning\">1,3,5,7,9</span>可領取`;\n}else if(day === 2 || day === 4){\n  todayLimitLastIdNumber.innerHTML = `身分證末碼為<span class=\"h4 text-warning\">2,4,6,8,0</span>可領取`;\n}else if(day === 6){\n  todayLimitLastIdNumber.innerHTML = `身分證末碼單雙號皆可領取`;\n}else{\n  todayLimitLastIdNumber.innerHTML = `今日郵局沒有營業`;\n}\n\n// 將發送非同步請求後的結果(回傳 promise 物件)先存到常數中，以便透過 promise.all 來執行後續操作\nconst get3000Datas = getUrl('https://3000.gov.tw/hpgapi-openmap/api/getPostData');\nconst getCityDatas = getUrl('https://raw.githubusercontent.com/donma/TaiwanAddressCityAreaRoadChineseEnglishJSON/master/CityCountyData.json');\n\n\nPromise.all([get3000Datas, getCityDatas])\n  .then(res => {\n    const ticketDatas = res[0]; // 將撈取到的三倍券即時領券量資料存到變數中\n    const cityDatas = res[1]; // 將撈取到的各縣市地區資料存到變數中\n    let selectedCity = '臺北市'; // 存放選取縣市的變數(預設為臺北市)\n    let cityStr = ''; // 宣告在選擇縣市的下拉選單中的選項的組字串內容\n    let defaultAreaStr = ''; // 首次載入頁面時選擇地區下拉選單各選項的字串\n\n    // 將每間郵局的 marker 加到到地圖圖層上, 並渲染 pane(點擊 marker 時 popup 的視窗) 的內容\n    for (let i = 0; ticketDatas.length > i; i++) {\n      let markerIcon; // 存放 marker icon 樣式的變數\n      let ticketCountColor; // 存放三倍券數量文字樣式 class 的變數\n      if (parseInt(ticketDatas[i].total) === 0) { // 依據三倍券數量是否為 0 調整 marker 樣式與 pane 中的三倍券總數量文字樣式\n        markerIcon = redIcon;\n        ticketCountColor = 'text-danger';\n      } else {\n        markerIcon = greenIcon;\n        ticketCountColor = 'text-success';\n      }\n      markers.addLayer(L.marker([ticketDatas[i].latitude, ticketDatas[i].longitude], {\n        icon: markerIcon\n      }).bindPopup(`<h5>${ticketDatas[i].storeNm}</h5><p>地址：${ticketDatas[i].addr}</p><p>電話：${ticketDatas[i].tel}</p><p>營業時間：${ticketDatas[i].busiTime}</p><p>剩餘受理量：<strong class=\"${ticketCountColor}\">${ticketDatas[i].total}</strong></p><p>資訊更新時間：${ticketDatas[i].updateTime}</p><p>備註：${ticketDatas[i].busiMemo}</p>`));\n    }\n    map.addLayer(markers); // 將 markers 加入到地圖圖層上\n\n    // 首次載入頁面時側邊欄中預設顯示台北市的資料列表\n    const listDatas = ticketDatas.filter(function(item){\n      return item.hsnNm === '臺北市';\n    });\n    renderList(listDatas);\n\n    // 首次載入頁面時渲染預設的選擇地區下拉選單的各選項\n    const defaultCity = cityDatas.filter(function(city){\n      return city.CityName === '臺北市'\n    });\n    defaultAreaStr +=`<option value=\"全部地區\">全部地區</option>`;\n    defaultCity[0].AreaList.forEach(function(area){\n      defaultAreaStr +=`<option value=\"${area.AreaName}\">${area.AreaName}</option>`;\n    });\n    area.innerHTML = defaultAreaStr;\n\n    // 從撈取回來的縣市中逐筆組成選擇縣市的下拉選單中的各個選項\n    cityDatas.forEach(function(item, index){\n      cityStr += `<option value=\"${item.CityName}\">${item.CityName}</option>`;\n    });\n    city.innerHTML = cityStr;\n\n    // 依據選取的縣市渲染對應的側邊欄列表資訊\n    city.addEventListener('change', function(e){\n      let areaStr = ''; // 組選擇地區的下拉選單中的各選項用的字串\n      selectedCity = e.target.value; // 將選取到的縣市儲存到變數中以利其他操作\n\n      const listDatas = ticketDatas.filter(function(item){ // 從撈取回來的三倍券資料中過濾出與所選縣市吻合的各筆資料(只需要使用者所選取縣市的三倍券資料)\n        return item.addr.includes(selectedCity);\n      });\n      renderList(listDatas);\n\n      let cityList = cityDatas.filter(function(item){ // 從撈取回來的縣市資料中過濾出與所選縣市吻合的資料 (只需要使用者所選取縣市的地區資料)\n        return item.CityName === selectedCity;\n      });\n\n      areaStr += `<option value=\"全部地區\">全部地區</option>`; // 地區下拉選單的預設值\n      cityList[0].AreaList.forEach(function(item){ // 將所選縣市的各地區組成下拉選單中的各選項\n        areaStr += `<option value=\"${item.AreaName}\">${item.AreaName}</option>`\n      });\n      area.innerHTML = areaStr; // 將縣市的各地區選項顯示到選取地區的下拉選單元素中\n    });\n\n    // 依據選取的地區渲染對應的側邊欄列表資訊\n    area.addEventListener('change', function(e){\n      let selectedArea = e.target.value;\n      let listDatas;\n\n      if(selectedArea === '全部地區'){\n        listDatas = ticketDatas.filter(item => {\n          return item.addr.includes(selectedCity);\n        });\n      }else{\n        listDatas = ticketDatas.filter(item => {\n          return item.addr.includes(selectedCity+selectedArea);\n        });\n      }\n      renderList(listDatas);\n    });\n  })\n  .catch(function (err) { // 捕捉非同步請求錯誤時的錯誤訊息\n    console.log(err);\n  });"]}